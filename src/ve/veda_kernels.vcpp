#include "veda_device_internal.h"

//------------------------------------------------------------------------------
extern "C" {
//------------------------------------------------------------------------------
VEDAresult veda_memcpy_d2d(VEDAdeviceptr vdst_, VEDAdeviceptr vsrc_, const size_t size) {
	VEDAptr<char> vdst(vdst_);
	VEDAptr<char> vsrc(vsrc_);
	auto rdst = vdst.ptrSize();
	auto rsrc = vsrc.ptrSize();
	if((vdst.offset() + size) > rdst.size)	return VEDA_ERROR_OUT_OF_BOUNDS;
	if((vsrc.offset() + size) > rsrc.size)	return VEDA_ERROR_OUT_OF_BOUNDS;
	veda_omp_simd(size, [=](const size_t min, const size_t max) {
		memcpy(rdst.ptr + min, rsrc.ptr + min, max - min);
	});
	return VEDA_SUCCESS;
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u8(VEDAdeviceptr vdst, const uint8_t  value, const size_t cnt) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD8 (ptr.ptr(), value, cnt);
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u16(VEDAdeviceptr vdst, const uint16_t value, const size_t cnt) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD16(ptr.ptr(), value, cnt);
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u32(VEDAdeviceptr vdst, const uint32_t value, const size_t cnt) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD32(ptr.ptr(), value, cnt);
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u64(VEDAdeviceptr vdst, const uint64_t value, const size_t cnt) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD64(ptr.ptr(), value, cnt);
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u128(VEDAdeviceptr vdst, const uint64_t x, const uint64_t y, const size_t cnt) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD128(ptr.ptr(), x, y, cnt);
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u8_2d(VEDAdeviceptr vdst, const size_t pitch, const uint8_t value, const size_t w, const size_t h) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD2D8(ptr.ptr(), pitch, value, w, h);
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u16_2d(VEDAdeviceptr vdst, const size_t pitch, const uint16_t value, const size_t w, const size_t h) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD2D16(ptr.ptr(), pitch, value, w, h);
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u32_2d(VEDAdeviceptr vdst, const size_t pitch, const uint32_t value, const size_t w, const size_t h) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD2D32(ptr.ptr(), pitch, value, w, h);
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u64_2d(VEDAdeviceptr vdst, const size_t pitch, const uint64_t value, const size_t w, const size_t h) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD2D64(ptr.ptr(), pitch, value, w, h);
}

//------------------------------------------------------------------------------
VEDAresult veda_memset_u128_2d(VEDAdeviceptr vdst, const size_t pitch, const uint64_t x, const uint64_t y, const size_t w, const size_t h) {
	VEDAptr<> ptr(vdst);
	return vedaMemsetD2D128(ptr.ptr(), pitch, x, y, w, h);
}

//------------------------------------------------------------------------------
VEDAresult veda_mem_alloc(void** ptr, VEDAdeviceptr vptr, const size_t size) {
	return vedaMemAllocPtr(ptr, vptr, size);
}

//------------------------------------------------------------------------------
VEDAresult veda_mem_free(VEDAdeviceptr vptr) {
	return vedaMemFree(vptr);
}

//------------------------------------------------------------------------------
VEDAresult veda_mem_ptr(void** ptr, size_t* size, VEDAdeviceptr vptr) {
	return vedaMemPtrSize(ptr, size, vptr);
}

//------------------------------------------------------------------------------
}
