SET(AVEO_REPO		"https://github.com/SX-Aurora/aveo")
SET(AVEO_PATH		${CMAKE_CURRENT_BINARY_DIR}/aveo)
SET(AVEO_GIT_TAG	"ef/progress-thread-tuned")
SET(AVEO_NFORT		"/opt/nec/ve/bin/nfort" CACHE STRING "NFORT Version used to compile AVEO")

SET(libexecdir "@libexecdir@")
SET(velibdir "@velibdir@")
CONFIGURE_FILE(${CMAKE_CURRENT_LIST_DIR}/aveo.patch ${CMAKE_CURRENT_BINARY_DIR}/aveo.patch @ONLY)
UNSET(libexecdir)
UNSET(velibdir)

INCLUDE(ExternalProject)
ExternalProject_Add(aveo
	BINARY_DIR		${AVEO_PATH}/src
	BUILD_COMMAND		make
	CONFIGURE_COMMAND	""
	GIT_REPOSITORY		${AVEO_REPO}
	GIT_SHALLOW		FALSE
	GIT_TAG			${AVEO_GIT_TAG}
	INSTALL_COMMAND		make install
	INSTALL_DIR		""
	PATCH_COMMAND		git apply ${CMAKE_CURRENT_BINARY_DIR}/aveo.patch
	PREFIX			${AVEO_PATH}
	SOURCE_DIR		${AVEO_PATH}/src
	STAMP_DIR		${AVEO_PATH}/stamp
	TMP_DIR			${AVEO_PATH}/tmp
	UPDATE_DISCONNECTED 	TRUE
)

SET(AVEO_INCLUDE_DIRS	"${AVEO_PATH}/src/src/")
SET(AVEO_LIBRARY	"${AVEO_PATH}/src/install/lib64/libveo.so.1.0.0")
SET(AVEO_AVEORUN	"${AVEO_PATH}/src/install/libexec/aveorun")
SET(AVEO_AVEORUN_FTRACE	"${AVEO_PATH}/src/install/libexec/aveorun-ftrace")

INSTALL(FILES ${AVEO_LIBRARY} DESTINATION ${VEDA_INSTALL_PATH}/lib64 RENAME libveo.so.1)
INSTALL(FILES ${AVEO_AVEORUN} ${AVEO_AVEORUN_FTRACE} PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE DESTINATION ${VEDA_INSTALL_PATH}/libexec)

ILLYRIAN_INSTALL_SYMLINK(libveo.so.1 libveo.so ${VEDA_DIST_TYPE} DESTINATION ${VEDA_INSTALL_PATH}/lib64/)

SET(AVEO_LIBRARIES ${AVEO_LIBRARY})
